{{define "article_content"}}
<article>
  <h1>{{.article.Title}}</h1>
  <p>
    <small><a href="/users/{{.article.AuthorId}}">{{.article.AuthorName}}</a> 发布于<time>{{.article.CreatedAtStr}}</time>, 更新于<time>{{.article.UpdatedAtStr}}</time></small>
    {{if and .currUser (eq .currUser.Id .article.AuthorId)}}
    <small><a href="/articles/{{.article.Id}}/edit">编辑</a> <a href="javascript:handleDelete({{.article.Id}});" style="color:red">删除</a></small>
  </p>
  {{end}}
  <form method="post" action="/articles/{{.article.Id}}/delete" id="delForm" style="display: none">
    <input type="hidden" name="id" value="{{.article.Id}}">
  </form>
  <section>{{.article.Content}}</section>
</article>
{{end}}

{{define "article"}}

{{template "head" .}}

{{$data := dict "currUser" .LoginedUser "article" .Data}}
{{template "article_content" $data}}

<script>
  function handleDelete(id) {
    if (confirm('确认删除？')) {
      const formEl = document.getElementById('delForm')
      formEl.submit()
    }
  }
</script>
{{template "foot"}}
{{end}}
